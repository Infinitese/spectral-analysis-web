<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inharmonicity Analysis</title>

  <!-- â”€â”€â”€â”€â”€ Global Styles â”€â”€â”€â”€â”€ -->
  <style>
    :root {
      --bg:      #f9f9f9;
      --fg:      #333;
      --accent:  #2c3e50;
      --code-bg: #eee;
      --border:  #bbb;
    }

    /* base */
    body         { font-family: Arial, sans-serif; background: var(--bg); color: var(--fg); margin: 2rem; line-height: 1.6; }
    h1, h2, h3   { color: var(--accent); margin-top: 1.4rem; margin-bottom: .6rem; }
    h1           { font-size: 2rem; }
    h2           { font-size: 1.4rem; }
    h3           { font-size: 1.15rem; }
    p            { margin: .5rem 0 1rem; }
    .section     { margin-bottom: 2.2rem; }
    code, pre    { background: var(--code-bg); font-family: "Courier New", monospace; }
    code         { padding: 2px 4px; font-size: 90%; border-radius: 4px; }
    pre          { padding: .75rem 1rem; overflow-x: auto; border-radius: 6px; }

    /* media */
    img          { max-width: 620px; border: 1px solid #ccc; margin-bottom: 1.2rem; }
    audio        { margin: .3rem 0 1.2rem; width: 100%; max-width: 400px; }

    /* numeric table */
    .num-table      { border-collapse: collapse; margin: .5rem 0 1.2rem; }
    .num-table th,
    .num-table td   { border: 1px solid var(--border); padding: .25rem .6rem; text-align: right; }
    .num-table th   { background: #f2f2f2; }
    .num-table td:first-child,
    .num-table th:first-child { text-align: center; }

    /* simple call-outs */
    .formula    { margin: .6rem 0 .8rem; font-style: italic; }
    figure      { margin: .8rem 0 1.6rem; text-align: center; }
    figcaption  { font-size: 0.9rem; color: #666; margin-top: .4rem; }

    /* divider title */
    .divider-section {
      text-align: center;
      margin: 3em 0 2.5em;
    }

    .divider-title {
      display: inline-block;
      position: relative;
      font-size: 1.8em;
      padding: 0.5em 1em;
      background: var(--bg);
      color: var(--accent);
    }

    .divider-title::before,
    .divider-title::after {
      content: "";
      position: absolute;
      top: 50%;
      width: 50px;
      height: 1px;
      background: #ccc;
    }

    .divider-title::before {
      right: 100%;
      margin-right: 20px;
    }

    .divider-title::after {
      left: 100%;
      margin-left: 20px;
    }
    .result-block {
      background: var(--code-bg);
      font-family: "Courier New", monospace;
      padding: 0.8rem 1rem;
      border-radius: 6px;
      white-space: pre;          /* ä¿ç•™ç©ºæ ¼ç¼©è¿› */
      margin: 0.5rem 0 1.2rem;
    }
  </style>
</head>

<body>
  <h1>Inharmonicity Analysis</h1>

  <!-- 0. Overview -------------------------------------------------------- -->
  <section class="section">
    <h2>ğŸ” Project Overview</h2>
    <p>
      This page is just a start point by analysing a simple frame of vowel voice (<em>â€œahâ€</em>) and estimate the fundamental frequency
      (<code>fâ‚€</code>) and measure harmonic inharmonicity (<code>Î”<sub>k</sub></code>).
    </p>
  </section>

  <!-- 1. Audio ----------------------------------------------------------- -->
  <section class="section">
    <h2>ğŸ§ Audio Sample</h2>
    <audio controls>
      <source src="A_PM66PSO5_a_190303153700.wav" type="audio/wav" />
      Your browser does not support the audio element.
    </audio>
  </section>

  <!-- Divider Title ----------------------------------------------------- -->
  <section class="divider-section">
    <h2 class="divider-title">Exploratory Analysis of a 20 ms Frame</h2>
  </section>

  <!-- 2. Waveforms ------------------------------------------------------- -->
  <section class="section">
    <h2>ğŸ“ˆ Waveform of the 20 ms Frame</h2>
    <p>The extracted 20 ms frame (starting at 1 s):</p>
    <img src="extracted20ms.png" alt="20 ms frame waveform" />
  </section>

<section class="section">
  <h2>ğŸ§­ Frame Position in the Full Signal</h2>
  <p>The red segment shows where the 20 ms frame lies in the entire
     speech recording:</p>
  <img src="fullaudio.png" alt="Full waveform with highlighted frame" />
</section>

<!-- 3. Fundamental-frequency estimation -------------------------------- -->
<section class="section">
  <h2>ğŸ§® Step 1 â€” Coarse Harmonic Residual Scan</h2>
  <p>
    A 500-point grid between <strong>50 Hz and 400 Hz</strong>
    is evaluated.  For each candidate we build an
    <code>8&nbsp;Ã—&nbsp;N</code> harmonic matrix and record the residual
    energy <code>â€–x âˆ’ U aâ€–Â²</code>.  The global minimum is:
  </p>
  <pre><code>Coarse-scan f0 = 98.20 Hz
Coarse-scan w0 = 617.00 rad/s</code></pre>
  <p>(red marker in the residual plot below)</p>

  <figure>
    <img src="bestf0.png"   alt="Residual-energy curve" />
    <figcaption>Residual energy over 500 fâ‚€ candidates.</figcaption>
  </figure>
</section>

<!--  STEP 2  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section class="section">
  <h2>ğŸ¯ Step&nbsp;2 â€” Adaptive Harmonic-LS Refinement</h2>

  <p>
    The initial coarse scan merely shows <em>where</em>
    the global valley of the residual curve lies.
    To lock onto the exact minimum we run
    <code>estimate_omega0</code>
    <span class="ref">(Elvander &amp; Jakobsson 2020)</span>,
    which repeats the following loop until the search interval
    is&nbsp;&lt;&nbsp;<code>10â»Â¹Â²&nbsp;rad/s</code> wide:
  </p>

  <ol>
    <li><strong>Bracket&nbsp;update</strong><br>
        Evaluate the cost on a 200-point grid inside the
        current interval <code>[Ï‰<sub>L</sub>, Ï‰<sub>H</sub>]</code>.</li>
    <li><strong>Narrowing</strong><br>
        Keep the best grid point and its two neighbours
        â‡’ new, shorter interval.</li>
    <li><strong>Re-grid</strong><br>
        Switch to a 50-point mesh for faster local convergence.</li>
  </ol>

  <ul>
    <li><strong>Harmonic order</strong>: K&nbsp;= 8</li>
    <li><strong>Initial interval</strong>: 50 Hz â€“ 400 Hz</li>
    <li><strong>Cost function</strong>:
        <code>â€–x â€“ U(Ï‰) (U(Ï‰)\x)â€–Â²</code></li>
  </ul>

  <pre><code>Refined f0 = 98.205 Hz
Refined w0 = 617.043 rad/s
Iterations  = 5 (â‰ˆ 7 ms on a laptop)</code></pre>

  <p>
    The refined <code>fâ‚€ / wâ‚€</code> serves as the harmonic
    baseline for the inharmonicity analysis in Step 3.
  </p>
</section>


<!-- 4. Inharmonicity analysis ----------------------------------------- -->
<!--  STEP 3 â€” OMT-prior Joint Estimation of Î”k  -->
<section class="section">
  <h2>ğŸ» Step&nbsp;3 â€” OMT-prior Joint Estimation&nbsp;of&nbsp;Î”<sub>k</sub></h2>

  <!-- 3-A  WHY -->
  <p>
    A real voice is never perfectly harmonic: every partial can drift
    a few hertz due to <em>jitter</em>, vocal-tract interaction or
    measurement noise.  
    We therefore estimate <strong>all</strong> sinusoidal frequencies
    <code>Ï‰Ì‚<sub>k</sub></code> <em>and</em> the best global pitch
    <code>Ï‰â‚€</code> in a single optimisation, using the
    <strong>Optimal&nbsp;Mass&nbsp;Transport&nbsp;(OMT) prior</strong>
    proposed by Elvander&nbsp;&amp;&nbsp;Jakobsson&nbsp;(2023).
  </p>

  <!-- 3-B  COST FUNCTION -->
  <h3>â€‚Cost function</h3>
  <p class="formula">
    <kbd>J(Ï‰Ì‚,a) = N Â· logâ€†â€–y âˆ’ A(Ï‰Ì‚)aâ€–Â²
       + (1&nbsp;/&nbsp;2Ïƒ<sub>Î”</sub>Â²) Â· Î£<sub>k</sub>
         |a<sub>k</sub>|Â² (Ï‰Ì‚<sub>k</sub> âˆ’ kÏ‰â‚€)Â²</kbd>
  </p>
  <ul>
    <li><code>A(Ï‰Ì‚)</code> â€” N Ã— K harmonic matrix
        <code>e<sup>j k Ï‰Ì‚ t</sup></code></li>
    <li><code>a</code> â€” complex amplitudes (optimised together)</li>
    <li><code>Ï‰â‚€&nbsp;â‰¡&nbsp;Ï‰â‚€(Ï‰Ì‚,a)</code>  
        &nbsp;= Î£|a<sub>k</sub>|Â² Ï‰Ì‚<sub>k</sub> /
        Î£|a<sub>k</sub>|Â² kÂ² &nbsp;<!-- matches your omega0_func --></li>
    <li><code>Ïƒ<sub>Î”</sub> = 2 Hz</code> â‡’
        <code>Î» = 1 / (2Ïƒ<sub>Î”</sub>Â²)</code></li>
  </ul>
  <p>
    The first term favours a close fit to the waveform,  
    the second pulls each partial toward its integer grid position
    <code>kÂ·Ï‰â‚€</code> with a quadratic â€œtransportâ€ cost.
  </p>

  <!-- 3-C  OPTIMISATION PROCEDURE -->
  <h3>â€‚Optimisation procedure</h3>
  <ol>
    <li><b>Initial guess</b>: perfectly harmonic grid
        <code>Ï‰Ì‚<sub>k,0</sub> = kÂ·Ï‰â‚€<sub>LS</sub></code>.</li>
    <li><b>Parameter vector</b>:
        <code>[ Ï‰Ì‚<sub>1:K</sub>, Re{a}<sub>1:K</sub>,
                Im{a}<sub>1:K</sub> ] â†’ 3K&nbsp;dims</code>.</li>
    <li><b>Solver</b>: Nelderâ€“Mead
        (<code>fminsearch</code>, tol = 10<sup>-10</sup>).  
        Converges in&nbsp;â‰ˆ 30â€“50 iterations for a 20 ms frame.</li>
  </ol>

  <!-- 3-D  NUMERIC RESULTS (table stays the same) -->
  <h3>â€‚Numerical results</h3>
  <p>
    <strong>f<sub>0,LS</sub> = 98.205 Hz</strong> |
    <strong>f<sub>0,OMT</sub> = 98.181 Hz</strong>
    (<em>difference 0.025 Hz</em>)
  </p>

  <table class="num-table">
    <thead>
      <tr>
        <th>k</th><th>Ï‰Ì‚<sub>k</sub> (Hz)</th>
        <th>kÂ·f<sub>0,OMT</sub> (Hz)</th>
        <th>Î”<sub>k</sub> (Hz)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>101.846</td><td>98.181</td><td>+3.673</td></tr>
      <tr><td>2</td><td>194.872</td><td>196.362</td><td>âˆ’1.496</td></tr>
      <tr><td>3</td><td>294.725</td><td>294.544</td><td>+0.191</td></tr>
      <tr><td>4</td><td>390.122</td><td>392.725</td><td>âˆ’2.600</td></tr>
      <tr><td>5</td><td>488.501</td><td>490.906</td><td>âˆ’2.401</td></tr>
      <tr><td>6</td><td>590.860</td><td>589.087</td><td>+1.780</td></tr>
      <tr><td>7</td><td>684.763</td><td>687.269</td><td>âˆ’2.508</td></tr>
      <tr><td>8</td><td>786.328</td><td>785.450</td><td>+0.888</td></tr>
    </tbody>
  </table>

  <!-- 3-E  DERIVED METRICS / PLOT -->
  <h3>â€‚Derived metrics</h3>
  <ul>
    <li><b>OMT cost</b>: 6.10 Ã— 10<sup>2</sup></li>
  </ul>

  <figure>
    <img src="deviation.png" alt="Stem plot of Î”_k (Hz)">
    <figcaption>
      Î”<sub>k</sub> stem plot: peak-to-peak Â±4 Hz, alternating sign â€”
      typical of short-term jitter rather than physical string inharmonicity.
    </figcaption>
  </figure>
</section>

<!-- Divider Title ----------------------------------------------------- -->
<section class="divider-section">
  <h2 class="divider-title">Sliding Window Analysis of Multiple Audios</h2>
</section>

<section class="divider-section">
  <h2 class="divider-title">Sliding Window Analysis of Multiple Utterances</h2>
</section>

<section class="section">
  <h3>ğŸ“ Method Recap</h3>
  <p>
    For each recording we slide a <strong>20&nbsp;ms frame</strong> with a
    <strong>10&nbsp;ms hop</strong>.  Each frameâ€™s fundamental frequency
    (<code>fâ‚€</code>) and inharmonic offsets
    (<code>Î”<sub>k</sub></code>,&nbsp;k = 1â€’8) are estimated via the
    OMT-based routine established earlier.
    After discarding unvoiced or abnormal frames (<em>fâ‚€</em> &lt; 80 Hz
    or &gt; 300 Hz), we summarise every recording by the mean and standard
    deviation of each <code>Î”<sub>k</sub></code>.  Below are the raw
    statistics per recording.
  </p>
</section>

<!-- Speaker 1 ========================================================= -->
<section class="section">
  <h3>ğŸ—£ï¸ Speaker&nbsp;1 &nbsp;|&nbsp; 10 recordings</h3>

  <!-- ç¤ºä¾‹ï¼šåªå±•ç¤ºç¬¬ 1 æ¡ï¼Œå…¶ä½™å¯å¤åˆ¶ç²˜è´´ -->
  <details open>
    <summary>Recording&nbsp;1 &nbsp;(<code>Recording1.wav</code>)</summary>
    <pre class="result-block">
Valid voiced frames : 212
Mean f0 (OMT)       : 88.23 Â± 3.13  Hz
Per-harmonic statistics (Hz)
 k |  mean |  std
---+-------+------
 1 |  7.59 |  5.91
 2 |  5.81 | 16.92
 3 | -6.31 | 24.56
 4 | -4.48 | 26.80
 5 |  2.97 | 17.62
 6 |  2.07 | 15.52
 7 | -1.50 |  7.30
 8 |  0.71 | 15.12
    </pre>
  </details>

  <!-- æŠ˜å å—æ¨¡æ¿ï¼Œå¯å¤åˆ¶ 9 æ¬¡å¹¶æ›¿æ¢å†…å®¹ -->
  <!--
  <details>
    <summary>Recording&nbsp;2 &nbsp;(<code>Recording2.wav</code>)</summary>
    <pre class="result-block">â€¦ç²˜è´´ Î” è¡¨æ ¼â€¦</pre>
  </details>
  -->
</section>

<!-- Speaker 2 ========================================================= -->
<section class="section">
  <h3>ğŸ—£ï¸ Speaker&nbsp;2 &nbsp;|&nbsp; 3 recordings</h3>

  <details open>
    <summary>Recording&nbsp;1</summary>
    <pre class="result-block">â€¦ç²˜è´´ Î” è¡¨æ ¼â€¦</pre>
  </details>
  <!-- Recording 2 / 3 åŒç† -->
</section>

<!-- Speaker 3 ========================================================= -->
<section class="section">
  <h3>ğŸ—£ï¸ Speaker&nbsp;3 &nbsp;|&nbsp; 3 recordings</h3>

  <details open>
    <summary>Recording&nbsp;1</summary>
    <pre class="result-block">â€¦ç²˜è´´ Î” è¡¨æ ¼â€¦</pre>
  </details>
  <!-- Recording 2 / 3 åŒç† -->
</section>

  
</body>
</html>

