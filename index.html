<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spectral Analysis Project</title>

<!-- ───── Global Styles ───── -->
<style>
  :root {
    --bg:      #f9f9f9;
    --fg:      #333;
    --accent:  #2c3e50;
    --code-bg: #eee;
    --border:  #bbb;
  }

  /* base */
  body         { font-family: Arial, sans-serif; background: var(--bg); color: var(--fg); margin: 2rem; line-height: 1.6; }
  h1, h2, h3   { color: var(--accent); margin-top: 1.4rem; margin-bottom: .6rem; }
  h1           { font-size: 2rem; }
  h2           { font-size: 1.4rem; }
  h3           { font-size: 1.15rem; }
  p            { margin: .5rem 0 1rem; }
  .section     { margin-bottom: 2.2rem; }
  code, pre    { background: var(--code-bg); font-family: "Courier New", monospace; }
  code         { padding: 2px 4px; font-size: 90%; border-radius: 4px; }
  pre          { padding: .75rem 1rem; overflow-x: auto; border-radius: 6px; }

  /* media */
  img          { max-width: 620px; border: 1px solid #ccc; margin-bottom: 1.2rem; }
  audio        { margin: .3rem 0 1.2rem; width: 100%; max-width: 400px; }

  /* numeric table */
  .num-table      { border-collapse: collapse; margin: .5rem 0 1.2rem; }
  .num-table th,
  .num-table td   { border: 1px solid var(--border); padding: .25rem .6rem; text-align: right; }
  .num-table th   { background: #f2f2f2; }
  .num-table td:first-child,
  .num-table th:first-child { text-align: center; }

  /* simple call-outs */
  .formula    { margin: .6rem 0 .8rem; font-style: italic; }
  figure      { margin: .8rem 0 1.6rem; text-align: center; }
  figcaption  { font-size: 0.9rem; color: #666; margin-top: .4rem; }
</style>
</head>

<body>
<h1>Spectral Analysis Project</h1>

<!-- 0. Overview -------------------------------------------------------- -->
<section class="section">
  <h2>🔍 Project Overview</h2>
  <p>
    This page demonstrates a small-scale spectral analysis of a sustained
    vowel (<em>“ah”</em>).  We estimate the fundamental frequency
    (<code>f₀</code>) and measure harmonic inharmonicity
    (<code>Δ<sub>k</sub></code>) frame-by-frame.
  </p>
</section>

<!-- 1. Audio ----------------------------------------------------------- -->
<section class="section">
  <h2>🎧 Audio Sample</h2>
  <audio controls>
    <source src="A_PM66PSO5_a_190303153700.wav" type="audio/wav" />
    Your browser does not support the audio element.
  </audio>
</section>

<!-- 2. Waveforms ------------------------------------------------------- -->
<section class="section">
  <h2>📈 Waveform of the 20 ms Frame</h2>
  <p>The extracted 20 ms frame (starting at 1 s):</p>
  <img src="extracted20ms.png" alt="20 ms frame waveform" />
</section>

<section class="section">
  <h2>🧭 Frame Position in the Full Signal</h2>
  <p>The red segment shows where the 20 ms frame lies in the entire
     speech recording:</p>
  <img src="fullaudio.png" alt="Full waveform with highlighted frame" />
</section>

<!-- 3. Fundamental-frequency estimation -------------------------------- -->
<section class="section">
  <h2>🧮 Step 1 — Coarse Harmonic Residual Scan</h2>
  <p>
    A 500-point grid between <strong>50 Hz and 400 Hz</strong>
    is evaluated.  For each candidate we build an
    <code>8&nbsp;×&nbsp;N</code> harmonic matrix and record the residual
    energy <code>‖x − U a‖²</code>.  The global minimum is:
  </p>
  <pre><code>Coarse-scan f0 = 98.20 Hz
Coarse-scan w0 = 617.00 rad/s</code></pre>
  <p>(red marker in the residual plot below)</p>

  <figure>
    <img src="bestf0.png"   alt="Residual-energy curve" />
    <figcaption>Residual energy over 500 f₀ candidates.</figcaption>
  </figure>
</section>

<!--  STEP 2  ────────────────────────────────────────── -->
<section class="section">
  <h2>🎯 Step&nbsp;2 — Adaptive Harmonic-LS Refinement</h2>

  <p>
    The initial coarse scan merely shows <em>where</em>
    the global valley of the residual curve lies.
    To lock onto the exact minimum we run
    <code>estimate_omega0</code>
    <span class="ref">(Elvander &amp; Jakobsson 2020)</span>,
    which repeats the following loop until the search interval
    is&nbsp;&lt;&nbsp;<code>10⁻¹²&nbsp;rad/s</code> wide:
  </p>

  <ol>
    <li><strong>Bracket&nbsp;update</strong><br>
        Evaluate the cost on a 200-point grid inside the
        current interval <code>[ω<sub>L</sub>, ω<sub>H</sub>]</code>.</li>
    <li><strong>Narrowing</strong><br>
        Keep the best grid point and its two neighbours
        ⇒ new, shorter interval.</li>
    <li><strong>Re-grid</strong><br>
        Switch to a 50-point mesh for faster local convergence.</li>
  </ol>

  <ul>
    <li><strong>Harmonic order</strong>: K&nbsp;= 8</li>
    <li><strong>Initial interval</strong>: 50 Hz – 400 Hz</li>
    <li><strong>Cost function</strong>:
        <code>‖x – U(ω) (U(ω)\x)‖²</code></li>
  </ul>

  <pre><code>Refined f0 = 98.205 Hz
Refined w0 = 617.043 rad/s
Iterations  = 5 (≈ 7 ms on a laptop)</code></pre>

  <p>
    The refined <code>f₀ / w₀</code> serves as the harmonic
    baseline for the inharmonicity analysis in Step 3.
  </p>
</section>


<!-- 4. Inharmonicity analysis ----------------------------------------- -->
<!--  STEP 3  ────────────────────────────────────────── -->
<section class="section">
  <h2>🎻 Step&nbsp;3 — OMT-prior Joint Estimation&nbsp;of Δ<sub>k</sub></h2>

  <p>
    Real speech is never perfectly harmonic: each partial can shift by a
    few&nbsp;hertz (<em>jitter</em>, <em>formant-pulling</em>, etc.).
    We therefore estimate all sinusoidal frequencies
    <code>ω̂<sub>k</sub></code> <em>and</em> the best overall
    pitch <code>ω₀</code> by minimising
  </p>

  <p class="formula">
    log-likelihood&nbsp;︵data︶ &nbsp;+&nbsp;
    <code>λ&nbsp;·&nbsp;∑<sub>k</sub>|a<sub>k</sub>|² Δ<sub>k</sub>²</code>,
  </p>

  <p>
    where <code>Δ<sub>k</sub> = ω̂<sub>k</sub> − k ω₀</code>.
    The second term is the
    <strong>Optimal Mass Transport (OMT) prior</strong>:
    each harmonic (mass |a<sub>k</sub>|²) is “transported” to its
    integer grid position at a quadratic cost.
  </p>

  <h3>Algorithm details</h3>
  <ul>
    <li><strong>σ<sub>Δ</sub> = 2 Hz</strong> ⇒ λ = 1 ⁄ (2σ<sub>Δ</sub>²)</li>
    <li><strong>Initial frequencies</strong>:
        the perfectly harmonic grid k·ω₀<sub>LS</sub></li>
    <li><strong>Optimiser</strong>:
        Nelder–Mead over&nbsp;3K parameters
        <code>[ω̂, Re{a}, Im{a}]</code></li>
  </ul>

  <!-- numeric results already present below; keep them -->
</section>


  <!-- numeric results table -->
  <h3>🔢 Numerical results</h3>
  <p>
    <strong>f<sub>0,LS</sub> = 98.205 Hz</strong>  | 
    <strong>f<sub>0,OMT</sub> = 98.181 Hz</strong>
    (<em>diff&nbsp;0.025 Hz</em>)
  </p>

  <table class="num-table">
    <thead>
      <tr>
        <th>k</th><th>ω̂<sub>k</sub> (Hz)</th>
        <th>k·f<sub>0,OMT</sub> (Hz)</th><th>Δ<sub>k</sub> (Hz)</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>101.846</td><td>98.181</td><td>+3.673</td></tr>
      <tr><td>2</td><td>194.872</td><td>196.362</td><td>−1.496</td></tr>
      <tr><td>3</td><td>294.725</td><td>294.544</td><td>+0.191</td></tr>
      <tr><td>4</td><td>390.122</td><td>392.725</td><td>−2.600</td></tr>
      <tr><td>5</td><td>488.501</td><td>490.906</td><td>−2.401</td></tr>
      <tr><td>6</td><td>590.860</td><td>589.087</td><td>+1.780</td></tr>
      <tr><td>7</td><td>684.763</td><td>687.269</td><td>−2.508</td></tr>
      <tr><td>8</td><td>786.328</td><td>785.450</td><td>+0.888</td></tr>
    </tbody>
  </table>

  <!-- derived metrics -->
  <h3>📈 Derived frame metrics</h3>
  <ul>
    <li><strong>RMS jitter</strong>: 2.80 Hz (2.9 % of f₀)</li>
    <li><strong>Linear-approx B</strong>: −1.76 × 10<sup>−2</sup></li>
    <li><strong>OMT cost</strong>: 6.10 × 10<sup>2</sup></li>
  </ul>

  <figure>
    <img src="img/delta_stem.png" alt="Stem plot of Δ_k (Hz)" />
    <figcaption>
      Alternating signs and ±4 Hz span indicate mainly short-term jitter;
      fitted B is small and negative.
    </figcaption>
  </figure>
</section>

</body>
</html>

